<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>VYBS</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Advent+Pro:ital,wght@0,100..900;1,100..900&family=Kanit:wght@400;700&display=swap');

html, body {
  margin: 0; padding: 0; 
  background:#5B69FF;
}

#riveCanvas {
  position: absolute;
  top: 0; 
  left: 0;
  z-index: 1;
}
.holder{
    display:flex;
    justify-content:center;
    align-items:center;
    font-family:"Kanit", sans-serif;
    position:relative;
    z-index:0;
    width:360px;
    margin:0 auto;
}
button{
  border-radius: 8px;
background: #D8524D !important;
box-shadow: 0 -6px 0 0 #9F423E inset;
border: none !important;
outline:none !important;
font-family:"Kanit", sans-serif;
color:white;
left:50%; transform:translateX(-50%);
width:90px;
top:90vh; 
height:54px;
}
h2{  font-family:"Kanit", sans-serif;}
</style>
</head>
<body>
  <!-- Loader -->
<div id="loader" style="position: fixed; inset: 0; background: white; display: flex; align-items: center; justify-content: center; z-index: 9999;">
  <h2>Loading...</h2>
</div>
<div class="holder"><img src="v3-scroll content up.png"><canvas id="riveCanvas"></canvas><button id="claimBtn" style="
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 10000;
  padding: 12px 24px;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  border: none;
  background: white;
">Claim</button></div>




<script src="https://unpkg.com/@rive-app/webgl2"></script>

<script>
const riveCanvas = document.getElementById('riveCanvas');
const claimBtn = document.getElementById("claimBtn"); // Query button after DOM is ready

const dpr = window.devicePixelRatio || 1;


let riveInstance = null;
let inputs = {};
let isClaimed = null;

// Artboard configuration for toggling
const artboards = [
  { name: "dollar", stateMachine: "dollar" },
  { name: "golden", stateMachine: "golden" },
  { name: "blue", stateMachine: "blue" }
];
let currentArtboardIndex = 0;
let currentArtboard = artboards[currentArtboardIndex].name;

function loadStateMachine(name) {
  console.log("Loading:", name);

  // Clean up old instance before creating new one (only here, NOT in onLoad)
  if (riveInstance) riveInstance.cleanup();

  riveInstance = new rive.Rive({
    src: "rive/vybs_flying_tokens3.riv",
    canvas: riveCanvas,
    artboard: currentArtboard,
    stateMachines: name,  // use 'name' passed from switchTo
    autoplay: true,
    fit: rive.Fit.Contain,
    alignment: rive.Alignment.Center,
    devicePixelRatio: 1,

    onLoad: () => {
      // Don't cleanup here!
      loader.style.display = "none";
      riveCanvas.style.display = "block";

      // Get artboard dimensions and scale up the animation
      const artboard = riveInstance.artboard;
      if (artboard) {
        const originalWidth = artboard.bounds.maxX - artboard.bounds.minX;
        const originalHeight = artboard.bounds.maxY - artboard.bounds.minY;
        
        // Scale factor - increase this to make animation larger
        const scaleFactor = 0.8;
        
        const width = originalWidth * scaleFactor;
        const height = originalHeight * scaleFactor;
        
        riveCanvas.width = width * dpr;
        riveCanvas.height = height * dpr;
        riveCanvas.style.width = width + "px";
        riveCanvas.style.height = height + "px";
        
        // IMPORTANT: Tell Rive to re-render at the new canvas size
        riveInstance.resizeDrawingSurfaceToCanvas();
        
        console.log(`Canvas set to ${scaleFactor}x size: ${width}x${height}px (original: ${originalWidth}x${originalHeight}px)`);
      }

      inputs = Object.fromEntries(riveInstance.stateMachineInputs(name).map(i => [i.name, i]));
      isClaimed = inputs.is_Claimed;

      if (isClaimed) {
        claimBtn.disabled = false;
        claimBtn.style.opacity = 1;
        claimBtn.style.cursor = "pointer";
      } else {
        console.error("âŒ is_claimed input not found!");
      }

      console.log(`Loaded ${name}, isClaimed input set.`);
    },

    onStateChange: (event) => {
      // Use correct case for Exit state
      const states = event.data;
      const exited = (Array.isArray(states) && states.includes("exit")) || states === "exit";

      if (exited) {
        console.log("State machine reached Exit.");

        if (isClaimed) {
          isClaimed.value = false;
          console.log("ðŸ”„ is_claimed reset to false");

          riveInstance.reset();
          riveInstance.play();
        }

        claimBtn.disabled = false;
        claimBtn.style.opacity = 1;
        claimBtn.style.cursor = "pointer";
      }
    },

    onError: (err) => console.error("Rive Load Error:", err)
  });
}

// Add event listener to toggle between artboards
claimBtn.addEventListener("click", () => {
  // Move to next artboard
  currentArtboardIndex = (currentArtboardIndex + 1) % artboards.length;
  currentArtboard = artboards[currentArtboardIndex].name;
  const stateMachine = artboards[currentArtboardIndex].stateMachine;
  
  console.log(`ðŸ”„ Switching to artboard: ${currentArtboard} with state machine: ${stateMachine}`);
  
  // Load the new artboard
  switchTo(stateMachine);
});

// Initialize with first artboard
switchTo(artboards[0].stateMachine);

function switchTo(machineName) {
  loadStateMachine(machineName);
}


// Canvas size is now controlled by Rive's original dimensions



</script>


</body>
</html>
